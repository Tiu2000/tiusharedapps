<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TIU Mixer Pro v20 - Universal</title>
    <style>
        :root {
            --bg-color: #121212;
            --deck-bg: #1e1e1e;
            --accent: #00ff9d; 
            --accent-dim: #008f58;
            --cue-active: #ff0055;
            --loop-active: #ffee00;
            --text-color: #e0e0e0;
            --bar-color: #00ccff;
        }

        body {
            margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-color);
            font-family: 'Roboto', 'Arial', sans-serif; 
            overflow: hidden; /* Prevent scrolling on mobile to treat it like an app */
            touch-action: none;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; width: 100vw;
        }

        /* --- SCALING WRAPPER --- */
        /* This container holds the entire app and scales it to fit the screen */
        #scaler {
            transform-origin: center center;
            display: flex; flex-direction: column; align-items: center;
            width: 1000px; /* Fixed "Design" width */
            height: 700px; /* Fixed "Design" height */
        }

        /* MAIN UI CONTAINER */
        .app-layer {
            width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center;
            background: #181818; padding: 20px; border-radius: 15px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.9); border: 1px solid #333;
            box-sizing: border-box;
        }

        header { 
            width: 100%; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 15px; height: 50px;
        }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; color: #fff; }

        /* --- CONSOLE LAYOUT --- */
        .console { display: flex; gap: 15px; height: 400px; width: 100%; }

        .deck {
            background: var(--deck-bg); flex: 1; padding: 15px; border-radius: 8px;
            display: flex; flex-direction: column; gap: 10px; border: 1px solid #444; position: relative;
        }

        /* TRACK TITLE */
        .track-title {
            font-size: 0.9rem; color: #fff; text-align: center; padding: 5px;
            background: #111; border: 1px solid #333; border-radius: 4px;
            white-space: nowrap; overflow: hidden; text-overflow: ellipsis; height: 25px;
        }

        /* DECK VISUALS */
        .deck-top { display: flex; gap: 15px; height: 140px; }
        
        .vinyl-wrapper { width: 140px; height: 140px; position: relative; }
        .vinyl {
            width: 100%; height: 100%; background: #111; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 2px solid #333;
        }
        .vinyl-grooves {
            width: 90%; height: 90%; border-radius: 50%; position: absolute;
            background: repeating-radial-gradient(#151515, #151515 2px, #252525 3px, #252525 4px);
        }
        .vinyl-label {
            width: 35%; height: 35%; background: #d32f2f; border-radius: 50%; z-index: 2;
            border: 2px solid #fff; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; font-weight: bold; color: white;
        }
        .deck-b .vinyl-label { background: #1976d2; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        .spinning { animation: spin 1.8s linear infinite; }
        .paused { animation-play-state: paused; }

        /* GAIN SLIDER */
        .gain-container {
            display: flex; flex-direction: column; align-items: center; width: 30px;
            background: #111; border-radius: 4px; padding: 5px 0; border: 1px solid #333;
        }
        .gain-label { font-size: 0.5rem; color: #888; margin-bottom: 5px; }
        input[type=range].vertical-fader {
            writing-mode: bt-lr; -webkit-appearance: slider-vertical;
            width: 100%; height: 100%; background: transparent;
        }

        /* INFO DISPLAY */
        .deck-info {
            background: #0f0f0f; border: 1px solid #333; padding: 8px; border-radius: 4px;
            font-family: 'Courier New', monospace; color: var(--accent); font-size: 0.9rem;
            display: flex; flex-direction: column; gap: 5px; height: 60px; justify-content: center;
        }
        .info-row { display: flex; justify-content: space-between; width: 100%; align-items: center; }

        /* CONTROLS */
        .pad-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; height: 50px; }
        .pad {
            background: #333; border: none; color: #aaa; font-size: 0.7rem; font-weight: bold;
            border-radius: 4px; cursor: pointer; transition: all 0.1s; border-bottom: 2px solid #222;
        }
        .pad:active { transform: translateY(2px); border-bottom: none; background: #555; }
        .pad.set-mode { background: #500; color: #fff; animation: pulse 1s infinite; }
        .pad.has-cue { background: var(--accent-dim); color: #fff; border-bottom: 2px solid var(--accent); }
        .pad.loop-active { background: var(--loop-active); color: #000; box-shadow: 0 0 10px var(--loop-active); }

        .transport { display: flex; gap: 10px; height: 50px; }
        .btn-transport {
            flex: 1; background: #333; color: #fff; border: none;
            border-radius: 4px; font-weight: 900; font-size: 0.8rem; cursor: pointer;
            border-bottom: 3px solid #111;
        }
        .btn-play.active { background: var(--accent); box-shadow: 0 0 15px var(--accent); color: #000;}

        /* PITCH */
        .pitch-container {
            background: #111; padding: 5px; border-radius: 4px; border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center; height: 40px; justify-content: center;
        }
        .pitch-slider { width: 100%; -webkit-appearance: none; background: transparent; }
        .pitch-slider::-webkit-slider-track { height: 4px; background: #444; }
        .pitch-slider::-webkit-slider-thumb { 
            -webkit-appearance: none; height: 20px; width: 40px; background: #555; 
            margin-top: -8px; border-radius: 2px; border: 1px solid #888;
        }

        /* MIXER */
        .mixer {
            width: 120px; background: #1a1a1a; padding: 10px; border-radius: 8px; border: 1px solid #444;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
        }

        /* CRATE SECTION */
        .crate-section {
            width: 100%; flex: 1; margin-top: 15px; background: #111; border: 1px solid #333;
            border-radius: 8px; padding: 10px; box-sizing: border-box; overflow: hidden; display: flex; flex-direction: column;
        }
        
        .crate-controls { display: flex; gap: 10px; margin-bottom: 10px; }
        .crate-btn {
            background: var(--accent-dim); color: #fff; border: none; padding: 8px 15px;
            border-radius: 4px; font-weight: bold; font-size: 0.8rem;
        }
        
        .crate-list {
            flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 5px;
            background: #000; padding: 5px; border: 1px solid #333;
        }
        .crate-item {
            display: flex; justify-content: space-between; align-items: center;
            background: #1a1a1a; padding: 8px; border-radius: 4px; border: 1px solid #333;
        }
        .item-name { color: #fff; font-size: 0.85rem; flex: 1; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; }

        /* BULK MODAL */
        #bulk-modal {
            position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.95);
            z-index: 999; display: none; flex-direction: column; align-items: center; justify-content: center; padding: 20px;
        }
        #bulk-textarea { width: 80%; height: 50%; background: #111; color: #fff; border: 1px solid #444; font-family: monospace; padding: 10px; }

        /* HIDDEN ELEMENTS */
        #video-layer { position: fixed; top: 0; z-index: -1; opacity: 0; pointer-events: none; }
        
        /* LANDSCAPE WARNING */
        #portrait-warning {
            position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #000;
            z-index: 9999; display: none; color: white; align-items: center; justify-content: center;
            text-align: center; font-size: 1.5rem; padding: 20px;
        }
        @media (orientation: portrait) { #portrait-warning { display: flex; } }

    </style>
</head>
<body>

    <div id="portrait-warning">‚ö†Ô∏è<br>PLEASE ROTATE PHONE<br>TO LANDSCAPE</div>

    <div id="video-layer">
        <div id="player-a"></div>
        <div id="player-b"></div>
    </div>

    <div id="bulk-modal">
        <h2 style="color:white;">PASTE PLAYLIST / LINKS</h2>
        <textarea id="bulk-textarea" placeholder="Paste YouTube Links Here..."></textarea>
        <div style="margin-top:20px; display:flex; gap:20px;">
            <button class="crate-btn" onclick="processBulk()">PROCESS</button>
            <button class="crate-btn" style="background:#444;" onclick="document.getElementById('bulk-modal').style.display='none'">CANCEL</button>
        </div>
    </div>

    <div id="scaler">
        <div class="app-layer">
            <header>
                <h1>TIU MIXER <span style="font-size:0.8rem; border:1px solid var(--accent); padding:2px 5px; border-radius:4px; color:var(--accent);">MOBILE</span></h1>
                <button class="crate-btn" onclick="document.getElementById('bulk-modal').style.display='flex'">üìù BULK IMPORT</button>
            </header>

            <div class="console">
                <div class="deck" id="deck-a">
                    <div class="track-title" id="title-a">No Track Loaded</div>
                    <div class="deck-top">
                        <div class="vinyl-wrapper">
                            <div class="vinyl" id="vinyl-a">
                                <div class="vinyl-grooves"></div>
                                <div class="vinyl-label">A</div>
                            </div>
                        </div>
                        <div class="gain-container">
                            <input type="range" class="vertical-fader" id="gain-a" min="0" max="100" value="80" oninput="updateVol()">
                        </div>
                    </div>
                    <div class="deck-info">
                        <div class="info-row"><span id="time-a">00:00</span> <span id="bpm-a" style="cursor:pointer" onclick="tap('A')">TAP</span></div>
                    </div>
                    <div class="pad-grid">
                        <button class="pad" onclick="seek('A', -10)">-10</button>
                        <button class="pad" onclick="seek('A', 10)">+10</button>
                        <button class="pad" onclick="loop('A')">LOOP</button>
                        <button class="pad" onclick="exitLoop('A')">EXIT</button>
                    </div>
                    <div class="transport">
                        <button class="btn-transport" onclick="cue('A')">CUE</button>
                        <button class="btn-transport btn-play" id="play-a" onclick="playToggle('A')">PLAY</button>
                    </div>
                    <div class="pitch-container">
                        <input type="range" class="pitch-slider" id="pitch-a" min="0.5" max="1.5" step="0.001" value="1" oninput="updatePitch('A')">
                    </div>
                </div>

                <div class="mixer">
                    <div style="text-align:center; height: 60%;">
                        <div style="font-size:0.6rem; color:#666; margin-bottom:5px;">MASTER</div>
                        <input type="range" class="vertical-fader" id="master-vol" min="0" max="100" value="100" oninput="updateVol()">
                    </div>
                    <div style="width:100%;">
                        <div style="text-align:center; font-size:0.6rem; color:#666; margin-bottom:5px;">X-FADER</div>
                        <input type="range" id="crossfader" min="0" max="100" value="50" style="width:100%;" oninput="updateVol()">
                    </div>
                </div>

                <div class="deck deck-b" id="deck-b">
                    <div class="track-title" id="title-b">No Track Loaded</div>
                    <div class="deck-top">
                        <div class="gain-container">
                            <input type="range" class="vertical-fader" id="gain-b" min="0" max="100" value="80" oninput="updateVol()">
                        </div>
                        <div class="vinyl-wrapper">
                            <div class="vinyl" id="vinyl-b">
                                <div class="vinyl-grooves"></div>
                                <div class="vinyl-label">B</div>
                            </div>
                        </div>
                    </div>
                    <div class="deck-info">
                        <div class="info-row"><span id="time-b">00:00</span> <span id="bpm-b" style="cursor:pointer" onclick="tap('B')">TAP</span></div>
                    </div>
                    <div class="pad-grid">
                        <button class="pad" onclick="seek('B', -10)">-10</button>
                        <button class="pad" onclick="seek('B', 10)">+10</button>
                        <button class="pad" onclick="loop('B')">LOOP</button>
                        <button class="pad" onclick="exitLoop('B')">EXIT</button>
                    </div>
                    <div class="transport">
                        <button class="btn-transport" onclick="cue('B')">CUE</button>
                        <button class="btn-transport btn-play" id="play-b" onclick="playToggle('B')">PLAY</button>
                    </div>
                    <div class="pitch-container">
                        <input type="range" class="pitch-slider" id="pitch-b" min="0.5" max="1.5" step="0.001" value="1" oninput="updatePitch('B')">
                    </div>
                </div>
            </div>

            <div class="crate-section">
                <div class="crate-list" id="crate-list">
                    <div style="text-align:center; padding:20px; color:#444;">No tracks loaded. Use BULK IMPORT.</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- AUTO SCALER ---
        function resizeApp() {
            const scaler = document.getElementById('scaler');
            const winW = window.innerWidth;
            const winH = window.innerHeight;
            
            // Design resolution
            const baseW = 1000;
            const baseH = 700;

            const scaleX = winW / baseW;
            const scaleY = winH / baseH;
            
            // Fit within screen maintaining aspect or just fill
            const scale = Math.min(scaleX, scaleY) * 0.95; 

            scaler.style.transform = `scale(${scale})`;
        }
        window.addEventListener('resize', resizeApp);
        window.addEventListener('load', resizeApp);

        // --- APP LOGIC ---
        var players = { A: null, B: null };
        var ready = { A: false, B: false };
        var loops = { A: {active:false,in:0,out:0}, B: {active:false,in:0,out:0} };
        var tracks = [];

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = function() {
            createP('A', 'player-a');
            createP('B', 'player-b');
            setInterval(loopCheck, 100);
        };

        function createP(d, id) {
            players[d] = new YT.Player(id, {
                height: '100%', width: '100%',
                playerVars: { 'playsinline': 1, 'controls': 0 },
                events: {
                    'onReady': (e) => { ready[d] = true; updateVol(); },
                    'onStateChange': (e) => {
                        const vinyl = document.getElementById(`vinyl-${d.toLowerCase()}`);
                        const btn = document.getElementById(`play-${d.toLowerCase()}`);
                        if(e.data === 1) { 
                            vinyl.classList.add('spinning'); vinyl.classList.remove('paused');
                            btn.classList.add('active');
                        } else {
                            vinyl.classList.add('paused');
                            btn.classList.remove('active');
                        }
                    }
                }
            });
        }

        function playToggle(d) {
            if(!ready[d]) return;
            const s = players[d].getPlayerState();
            s === 1 ? players[d].pauseVideo() : players[d].playVideo();
        }

        function cue(d) {
            if(!ready[d]) return;
            players[d].pauseVideo();
            players[d].seekTo(0);
        }

        function seek(d, val) {
            if(!ready[d]) return;
            players[d].seekTo(players[d].getCurrentTime() + val, true);
        }

        function loop(d) {
            if(!ready[d]) return;
            loops[d].in = players[d].getCurrentTime();
            loops[d].out = loops[d].in + 4; // 4 sec loop approx
            loops[d].active = true;
        }
        function exitLoop(d) { loops[d].active = false; }

        function loopCheck() {
            ['A','B'].forEach(d => {
                if(ready[d]) {
                    const ct = players[d].getCurrentTime();
                    // Update Time
                    const m = Math.floor(ct/60).toString().padStart(2,'0');
                    const s = Math.floor(ct%60).toString().padStart(2,'0');
                    document.getElementById(`time-${d.toLowerCase()}`).innerText = `${m}:${s}`;
                    
                    // Check Loop
                    if(loops[d].active && ct >= loops[d].out) {
                        players[d].seekTo(loops[d].in, true);
                    }
                }
            });
        }

        function updateVol() {
            const m = document.getElementById('master-vol').value / 100;
            const x = document.getElementById('crossfader').value;
            const ga = document.getElementById('gain-a').value / 100;
            const gb = document.getElementById('gain-b').value / 100;
            let xa = 1, xb = 1;
            if (x < 50) xb = x/50;
            else if (x > 50) xa = 1 - ((x-50)/50);

            if(ready.A) players.A.setVolume(ga * xa * m * 100);
            if(ready.B) players.B.setVolume(gb * xb * m * 100);
        }

        function updatePitch(d) {
            if(!ready[d]) return;
            players[d].setPlaybackRate(parseFloat(document.getElementById(`pitch-${d.toLowerCase()}`).value));
        }

        // --- BULK ---
        function processBulk() {
            const txt = document.getElementById('bulk-textarea').value;
            const lines = txt.split('\n');
            let count = 0;
            lines.forEach(l => {
                let id = null;
                // Regex for standard URL or short URL or raw ID
                const m = l.match(/(?:v=|youtu\.be\/|\/)([a-zA-Z0-9_-]{11})/);
                if(m) id = m[1];
                else if(l.trim().length === 11) id = l.trim();

                if(id && !tracks.some(t => t.id === id)) {
                    tracks.push({ id: id, title: `Track ${id}` });
                    fetchTitle(id, tracks.length-1);
                    count++;
                }
            });
            renderList();
            document.getElementById('bulk-modal').style.display = 'none';
            document.getElementById('bulk-textarea').value = '';
            alert(`Added ${count} tracks!`);
        }

        function fetchTitle(id, idx) {
             fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${id}`)
            .then(r => r.json())
            .then(d => { if(d.title) { tracks[idx].title = d.title; renderList(); }});
        }

        function renderList() {
            const l = document.getElementById('crate-list');
            l.innerHTML = '';
            tracks.forEach((t, i) => {
                const d = document.createElement('div');
                d.className = 'crate-item';
                d.innerHTML = `
                    <span class="item-name">${t.title}</span>
                    <div style="display:flex; gap:5px;">
                        <button class="crate-btn" style="padding:4px 8px; font-size:0.7rem;" onclick="load(0,${i})">A</button>
                        <button class="crate-btn" style="padding:4px 8px; font-size:0.7rem;" onclick="load(1,${i})">B</button>
                    </div>
                `;
                l.appendChild(d);
            });
        }

        function load(deckIdx, trackIdx) {
            const d = deckIdx === 0 ? 'A' : 'B';
            const t = tracks[trackIdx];
            if(ready[d]) {
                players[d].loadVideoById(t.id);
                document.getElementById(`title-${d.toLowerCase()}`).innerText = t.title;
            }
        }
    </script>
</body>
</html>