<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TIU Mixer Pro v9 - Crate Edition</title>
    <style>
        :root {
            --bg-color: #121212;
            --deck-bg: #1e1e1e;
            --panel-bg: #252525;
            --accent: #00ff9d; 
            --accent-dim: #008f58;
            --cue-active: #ff0055;
            --loop-active: #ffee00;
            --text-color: #e0e0e0;
        }

        body {
            margin: 0; padding: 0; background-color: var(--bg-color); color: var(--text-color);
            font-family: 'Roboto', 'Arial', sans-serif; display: flex; flex-direction: column;
            align-items: center; min-height: 100vh; user-select: none;
            padding-bottom: 50px; /* Space for crate */
        }

        /* WATERMARK */
        .watermark {
            position: fixed; bottom: 20px; right: 30px; font-weight: 900; font-size: 6rem;
            color: rgba(255, 255, 255, 0.04); pointer-events: none; z-index: 0;
        }

        /* HIDDEN VIDEO LAYER */
        #video-layer { position: fixed; top: 0; z-index: -1; opacity: 0; pointer-events: none; }

        /* MAIN UI */
        .app-layer {
            z-index: 100; display: flex; flex-direction: column; align-items: center;
            background: #181818; padding: 20px; border-radius: 15px; margin-top: 20px;
            box-shadow: 0 30px 80px rgba(0,0,0,0.9); border: 1px solid #333;
        }

        header { 
            width: 100%; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 2px solid #333; padding-bottom: 15px; margin-bottom: 20px;
        }
        h1 { margin: 0; font-size: 1.5rem; letter-spacing: 2px; color: #fff; }

        /* CONSOLE GRID */
        .console { display: flex; gap: 15px; background: #000; padding: 20px; border-radius: 10px; border: 1px solid #333; }

        /* DECK STYLING */
        .deck {
            background: var(--deck-bg); width: 320px; padding: 15px; border-radius: 8px;
            display: flex; flex-direction: column; gap: 15px; border: 1px solid #444; position: relative;
        }

        /* TOP SECTION: INFO & VINYL */
        .deck-top { display: flex; gap: 15px; height: 160px; }
        
        .vinyl-wrapper { width: 160px; height: 160px; position: relative; }
        .vinyl {
            width: 100%; height: 100%; background: #111; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5); border: 2px solid #333;
        }
        .vinyl-grooves {
            width: 90%; height: 90%; border-radius: 50%; position: absolute;
            background: repeating-radial-gradient(#151515, #151515 2px, #252525 3px, #252525 4px);
        }
        .vinyl-label {
            width: 35%; height: 35%; background: #d32f2f; border-radius: 50%; z-index: 2;
            border: 2px solid #fff; display: flex; align-items: center; justify-content: center;
            font-size: 0.8rem; font-weight: bold; color: white;
        }
        .deck-b .vinyl-label { background: #1976d2; }

        @keyframes spin { 100% { transform: rotate(360deg); } }
        .spinning { animation: spin 1.8s linear infinite; }
        .paused { animation-play-state: paused; }

        /* GAIN SLIDER */
        .gain-container {
            display: flex; flex-direction: column; align-items: center; flex: 1;
            background: #111; border-radius: 4px; padding: 5px 0; border: 1px solid #333;
        }
        .gain-label { font-size: 0.6rem; color: #888; margin-bottom: 5px; }
        input[type=range].vertical-fader {
            writing-mode: bt-lr; -webkit-appearance: slider-vertical;
            width: 8px; height: 100%; background: transparent;
        }

        /* PERFORMANCE PADS */
        .pad-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 6px; }
        .pad {
            background: #333; border: none; color: #aaa; padding: 12px 0; font-size: 0.7rem; font-weight: bold;
            border-radius: 4px; cursor: pointer; transition: all 0.1s; border-bottom: 2px solid #222;
        }
        .pad:active { transform: translateY(2px); border-bottom: none; }
        .pad.set-mode { background: #500; color: #fff; animation: pulse 1s infinite; }
        .pad.has-cue { background: var(--accent-dim); color: #fff; border-bottom: 2px solid var(--accent); }
        .pad.loop-active { background: var(--loop-active); color: #000; box-shadow: 0 0 10px var(--loop-active); }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* TRANSPORT CONTROLS */
        .transport { display: flex; gap: 10px; }
        .btn-transport {
            flex: 1; padding: 12px; background: #333; color: #fff; border: none;
            border-radius: 4px; font-weight: 900; font-size: 0.8rem; cursor: pointer;
            border-bottom: 3px solid #111;
        }
        .btn-transport:active { transform: translateY(3px); border-bottom: none; }
        .btn-play { background: #ccc; color: #000; }
        .btn-play.active { background: var(--accent); box-shadow: 0 0 15px var(--accent); }
        .btn-cue { background: #d32f2f; }

        /* INFO DISPLAY */
        .deck-info {
            background: #0f0f0f; border: 1px solid #333; padding: 8px; border-radius: 4px;
            font-family: 'Courier New', monospace; color: var(--accent); font-size: 0.9rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .bpm-display { color: #fff; font-weight: bold; }

        /* PITCH FADER */
        .pitch-container {
            background: #111; padding: 10px; border-radius: 4px; border: 1px solid #333;
            display: flex; flex-direction: column; align-items: center;
        }
        .pitch-slider { width: 100%; -webkit-appearance: none; background: transparent; }
        .pitch-slider::-webkit-slider-track { height: 4px; background: #444; }
        .pitch-slider::-webkit-slider-thumb { 
            -webkit-appearance: none; height: 20px; width: 40px; background: #555; 
            margin-top: -8px; border-radius: 2px; border: 1px solid #888; cursor: ns-resize;
        }

        /* MIXER SECTION */
        .mixer {
            width: 140px; background: #1a1a1a; padding: 15px; border-radius: 8px; border: 1px solid #444;
            display: flex; flex-direction: column; align-items: center; justify-content: space-between;
        }

        /* --- CRATE (PLAYLIST) STYLES --- */
        .crate-container {
            width: 100%; max-width: 800px; margin-top: 20px;
            background: #111; border: 1px solid #333; border-radius: 8px;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .crate-header {
            background: #222; padding: 10px; color: #fff; font-weight: bold; letter-spacing: 1px;
            display: flex; justify-content: space-between; align-items: center;
        }
        .crate-list {
            max-height: 200px; overflow-y: scroll;
        }
        .crate-item {
            display: flex; justify-content: space-between; align-items: center;
            padding: 8px 15px; border-bottom: 1px solid #222; font-size: 0.8rem; color: #ccc;
        }
        .crate-item:hover { background: #1a1a1a; color: #fff; }
        .crate-item:last-child { border-bottom: none; }
        
        .crate-actions button {
            background: #333; color: white; border: none; padding: 5px 10px;
            font-size: 0.7rem; border-radius: 3px; cursor: pointer; margin-left: 5px;
            font-weight: bold;
        }
        .crate-actions button.load-a { background: #d32f2f; } /* Red for A */
        .crate-actions button.load-b { background: #1976d2; } /* Blue for B */
        .crate-actions button:hover { opacity: 0.8; }

        .add-track-form {
            display: flex; padding: 10px; background: #181818; border-top: 1px solid #333;
        }
        .add-track-input {
            flex: 1; background: #000; border: 1px solid #444; color: #fff; 
            padding: 8px; margin-right: 10px; font-size: 0.8rem;
        }
        
        /* LOG */
        .log-container {
            width: 100%; height: 60px; background: #000; border: 1px solid #333; 
            margin-top: 10px; padding: 5px; color: #0f0; font-family: monospace; 
            font-size: 0.7rem; overflow-y: scroll;
        }
    </style>
</head>
<body>

    <div class="watermark">TIU</div>

    <div id="video-layer">
        <div id="player-a"></div>
        <div id="player-b"></div>
    </div>

    <div class="app-layer">
        <header>
            <h1>TIU MIXER <span style="font-size:0.8rem; color:var(--accent); vertical-align: middle; border:1px solid var(--accent); padding:2px 5px; border-radius:4px;">PRO</span></h1>
            
            <div style="display:flex; align-items:center; gap:10px;">
                <span style="font-size:0.7rem; font-weight:bold; color:#666;">SYNC MODE</span>
                <label class="switch" style="position:relative; width:40px; height:20px;">
                    <input type="checkbox" id="sync-toggle">
                    <span style="position:absolute; top:0; left:0; right:0; bottom:0; background:#333; border-radius:20px;">
                        <span id="sync-knob" style="position:absolute; height:16px; width:16px; left:2px; bottom:2px; background:#fff; border-radius:50%; transition:0.3s;"></span>
                    </span>
                </label>
            </div>
        </header>

        <div class="console">
            
            <div class="deck" id="deck-a">
                <div class="deck-top">
                    <div class="vinyl-wrapper">
                        <div class="vinyl" id="vinyl-a"><div class="vinyl-grooves"></div><div class="vinyl-label">A</div></div>
                    </div>
                    <div class="gain-container">
                        <span class="gain-label">GAIN</span>
                        <input type="range" class="vertical-fader" id="gain-a" min="0" max="100" value="80" oninput="updateVolume()">
                    </div>
                </div>

                <div class="deck-info">
                    <span id="track-title-a" style="white-space:nowrap; overflow:hidden; max-width:140px;">No Track Loaded</span>
                    <span class="bpm-display" id="bpm-a">--- BPM</span>
                </div>

                <div class="pad-grid">
                    <button class="pad" id="cue-a-1" onclick="triggerHotCue('A', 1)">1</button>
                    <button class="pad" id="cue-a-2" onclick="triggerHotCue('A', 2)">2</button>
                    <button class="pad" id="cue-a-3" onclick="triggerHotCue('A', 3)">3</button>
                    <button class="pad" id="set-a" onclick="toggleSetMode('A')" style="color:#d32f2f;">SET</button>
                    
                    <button class="pad" onclick="loopIn('A')">IN</button>
                    <button class="pad" onclick="loopOut('A')">OUT</button>
                    <button class="pad" id="loop-exit-a" onclick="loopExit('A')">EXIT</button>
                    <button class="pad" onclick="tapBpm('A')">TAP</button>
                </div>

                <div class="transport">
                    <button class="btn-transport btn-cue" onclick="mainCue('A')">CUE</button>
                    <button class="btn-transport btn-play" id="play-a" onclick="togglePlay('A')">PLAY</button>
                    <button class="btn-transport" onclick="brake('A')" style="background:#555; font-size:0.6rem;">STOP</button>
                </div>

                <div class="pitch-container">
                    <div style="display:flex; justify-content:space-between; width:100%; font-size:0.6rem; color:#666; margin-bottom:5px;">
                        <span onclick="resetPitch('A')" style="cursor:pointer;">RESET</span>
                        <button id="sync-btn-a" onclick="syncDeck('A')" style="display:none; background:#00ccff; border:none; font-size:0.6rem; padding:2px 4px; cursor:pointer;">SYNC</button>
                    </div>
                    <input type="range" class="pitch-slider" id="pitch-a" min="0.5" max="1.5" step="0.001" value="1" oninput="updatePitch('A')">
                </div>
            </div>

            <div class="mixer">
                <div style="text-align:center;">
                    <div style="font-size:0.6rem; color:#666; margin-bottom:5px;">MASTER</div>
                    <input type="range" class="vertical-fader" id="master-vol" min="0" max="100" value="100" style="height:180px;" oninput="updateVolume()">
                </div>

                <div style="width:100%;">
                    <div style="text-align:center; font-size:0.6rem; color:#666; margin-bottom:5px;">CROSSFADER</div>
                    <input type="range" id="crossfader" min="0" max="100" value="50" style="width:100%; cursor:pointer;" oninput="updateVolume()">
                    <div style="display:flex; justify-content:space-between; font-size:0.7rem; color:#444; font-weight:bold; margin-top:5px;">
                        <span>A</span><span>B</span>
                    </div>
                </div>
            </div>

            <div class="deck deck-b" id="deck-b">
                <div class="deck-top">
                    <div class="gain-container">
                        <span class="gain-label">GAIN</span>
                        <input type="range" class="vertical-fader" id="gain-b" min="0" max="100" value="80" oninput="updateVolume()">
                    </div>
                    <div class="vinyl-wrapper">
                        <div class="vinyl" id="vinyl-b"><div class="vinyl-grooves"></div><div class="vinyl-label">B</div></div>
                    </div>
                </div>

                <div class="deck-info">
                    <span id="track-title-b" style="white-space:nowrap; overflow:hidden; max-width:140px;">No Track Loaded</span>
                    <span class="bpm-display" id="bpm-b">--- BPM</span>
                </div>

                <div class="pad-grid">
                    <button class="pad" id="cue-b-1" onclick="triggerHotCue('B', 1)">1</button>
                    <button class="pad" id="cue-b-2" onclick="triggerHotCue('B', 2)">2</button>
                    <button class="pad" id="cue-b-3" onclick="triggerHotCue('B', 3)">3</button>
                    <button class="pad" id="set-b" onclick="toggleSetMode('B')" style="color:#d32f2f;">SET</button>
                    
                    <button class="pad" onclick="loopIn('B')">IN</button>
                    <button class="pad" onclick="loopOut('B')">OUT</button>
                    <button class="pad" id="loop-exit-b" onclick="loopExit('B')">EXIT</button>
                    <button class="pad" onclick="tapBpm('B')">TAP</button>
                </div>

                <div class="transport">
                    <button class="btn-transport btn-cue" onclick="mainCue('B')">CUE</button>
                    <button class="btn-transport btn-play" id="play-b" onclick="togglePlay('B')">PLAY</button>
                    <button class="btn-transport" onclick="brake('B')" style="background:#555; font-size:0.6rem;">STOP</button>
                </div>

                <div class="pitch-container">
                    <div style="display:flex; justify-content:space-between; width:100%; font-size:0.6rem; color:#666; margin-bottom:5px;">
                        <span onclick="resetPitch('B')" style="cursor:pointer;">RESET</span>
                        <button id="sync-btn-b" onclick="syncDeck('B')" style="display:none; background:#00ccff; border:none; font-size:0.6rem; padding:2px 4px; cursor:pointer;">SYNC</button>
                    </div>
                    <input type="range" class="pitch-slider" id="pitch-b" min="0.5" max="1.5" step="0.001" value="1" oninput="updatePitch('B')">
                </div>
            </div>
        </div>

        <div class="crate-container">
            <div class="crate-header">
                <span>RECORD CRATE</span>
                <span style="font-size:0.6rem; color:#666;">LIBRARY</span>
            </div>
            <div class="crate-list" id="crate-list-ui">
                </div>
            <div class="add-track-form">
                <input type="text" id="new-track-url" class="add-track-input" placeholder="Paste YouTube URL...">
                <input type="text" id="new-track-title" class="add-track-input" placeholder="Title (Optional)...">
                <button onclick="addCustomTrack()" style="background:#444; color:#fff; border:none; padding:5px 15px; cursor:pointer; font-weight:bold;">ADD</button>
            </div>
        </div>
        
        <div class="log-container" id="sys-log"></div>
    </div>

    <script>
        // --- CORE VARIABLES ---
        var players = { A: null, B: null };
        var ready = { A: false, B: false };
        var loops = { A: { active: false, in: null, out: null }, B: { active: false, in: null, out: null } };
        var hotCues = { A: { 1: null, 2: null, 3: null, setMode: false }, B: { 1: null, 2: null, 3: null, setMode: false } };
        var tapData = { A: { lastTap: 0, count: 0, total: 0 }, B: { lastTap: 0, count: 0, total: 0 } };
        var loopInterval;

        // --- PLAYLIST DATA ---
        var crate = [
            { title: "Lofi Hip Hop - Chill", id: "5qap5aO4i9A" },
            { title: "Synthwave Mix", id: "4xDzrJKXOOY" },
            { title: "Deep House 124 BPM", id: "5r5d9C17yKk" },
            { title: "Techno Bunker", id: "7M6X5_2s0hA" },
            { title: "Liquid DnB", id: "Jt06nB2bEew" },
            { title: "Acid Jazz", id: "M0O7lLe4rAo" },
            { title: "Ambient Space", id: "wT5s7tqE2yA" },
            { title: "Disco Funk", id: "jfKfPfyJRdk" }
        ];

        function log(msg) {
            const div = document.getElementById('sys-log');
            const p = document.createElement('div');
            p.innerText = `> ${msg}`;
            div.prepend(p);
        }

        // --- YOUTUBE API ---
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        window.onYouTubeIframeAPIReady = function() {
            createPlayer('A', 'player-a');
            createPlayer('B', 'player-b');
            renderCrate();
            loopInterval = setInterval(checkLoops, 50);
        };

        function createPlayer(deck, id) {
            players[deck] = new YT.Player(id, {
                height: '100%', width: '100%', videoId: '',
                playerVars: { 'playsinline': 1, 'controls': 0, 'origin': window.location.origin },
                events: {
                    'onReady': (e) => { ready[deck] = true; log(`Deck ${deck} Ready`); updateVolume(); },
                    'onStateChange': (e) => updateVisuals(deck, e.data),
                    'onError': (e) => log(`Error Deck ${deck}: ${e.data}`)
                }
            });
        }

        // --- CRATE LOGIC ---
        function renderCrate() {
            const ui = document.getElementById('crate-list-ui');
            ui.innerHTML = '';
            crate.forEach((track, index) => {
                const item = document.createElement('div');
                item.className = 'crate-item';
                item.innerHTML = `
                    <span>${index + 1}. ${track.title}</span>
                    <div class="crate-actions">
                        <button class="load-a" onclick="loadFromCrate('A', '${track.id}', '${track.title}')">LOAD A</button>
                        <button class="load-b" onclick="loadFromCrate('B', '${track.id}', '${track.title}')">LOAD B</button>
                    </div>
                `;
                ui.appendChild(item);
            });
        }

        function loadFromCrate(deck, id, title) {
            if(ready[deck]) {
                log(`Deck ${deck}: Loading ${title}...`);
                players[deck].loadVideoById(id);
                document.getElementById(`track-title-${deck.toLowerCase()}`).innerText = title;
                resetDeckParams(deck);
            }
        }

        function addCustomTrack() {
            const url = document.getElementById('new-track-url').value;
            let title = document.getElementById('new-track-title').value;
            
            const match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);
            const id = (match && match[2].length === 11) ? match[2] : null;

            if(id) {
                if(!title) title = "Custom Track " + (crate.length + 1);
                crate.push({ title: title, id: id });
                renderCrate();
                log("Track added to Crate.");
                document.getElementById('new-track-url').value = '';
                document.getElementById('new-track-title').value = '';
            } else {
                log("Error: Invalid YouTube URL");
            }
        }

        function resetDeckParams(deck) {
            document.getElementById(`pitch-${deck.toLowerCase()}`).value = 1;
            updatePitch(deck);
            loops[deck] = { active: false, in: null, out: null };
            hotCues[deck] = { 1: null, 2: null, 3: null, setMode: false };
            updateLoopUI(deck);
            updateCueUI(deck);
        }

        // --- PLAYBACK CONTROLS ---
        function togglePlay(deck) {
            if(!ready[deck]) return;
            const state = players[deck].getPlayerState();
            state === 1 ? players[deck].pauseVideo() : players[deck].playVideo();
        }

        function mainCue(deck) {
            if(!ready[deck]) return;
            players[deck].pauseVideo();
            players[deck].seekTo(0);
        }

        function brake(deck) {
            if(!ready[deck]) return;
            log(`Deck ${deck}: Braking...`);
            players[deck].setPlaybackRate(0.5);
            setTimeout(() => {
                 players[deck].setPlaybackRate(0.25);
                 setTimeout(() => {
                     players[deck].pauseVideo();
                     players[deck].setPlaybackRate(1);
                 }, 200);
            }, 200);
        }

        function updatePitch(deck) {
            const val = document.getElementById(`pitch-${deck.toLowerCase()}`).value;
            if(ready[deck]) players[deck].setPlaybackRate(parseFloat(val));
        }
        
        function resetPitch(deck) {
            document.getElementById(`pitch-${deck.toLowerCase()}`).value = 1;
            updatePitch(deck);
        }

        // --- HOT CUES & LOOPS (Same as v8) ---
        function toggleSetMode(deck) {
            hotCues[deck].setMode = !hotCues[deck].setMode;
            document.getElementById(`set-${deck.toLowerCase()}`).classList.toggle('set-mode');
        }

        function triggerHotCue(deck, num) {
            if(!ready[deck]) return;
            const d = deck.toLowerCase();
            const btn = document.getElementById(`cue-${d}-${num}`);
            if (hotCues[deck].setMode) {
                hotCues[deck][num] = players[deck].getCurrentTime();
                btn.classList.add('has-cue');
                toggleSetMode(deck);
            } else if(hotCues[deck][num] !== null) {
                players[deck].seekTo(hotCues[deck][num], true);
                players[deck].playVideo();
            }
        }
        
        function updateCueUI(deck) {
            [1,2,3].forEach(n => document.getElementById(`cue-${deck.toLowerCase()}-${n}`).classList.remove('has-cue'));
        }

        function loopIn(deck) { if(ready[deck]) loops[deck].in = players[deck].getCurrentTime(); }
        function loopOut(deck) {
            if(ready[deck] && loops[deck].in !== null) {
                loops[deck].out = players[deck].getCurrentTime();
                loops[deck].active = true;
                document.getElementById(`loop-exit-${deck.toLowerCase()}`).classList.add('loop-active');
            }
        }
        function loopExit(deck) {
            loops[deck].active = false; loops[deck].in = null; loops[deck].out = null;
            updateLoopUI(deck);
        }
        function updateLoopUI(deck) { document.getElementById(`loop-exit-${deck.toLowerCase()}`).classList.remove('loop-active'); }

        function checkLoops() {
            ['A', 'B'].forEach(deck => {
                if(ready[deck] && loops[deck].active && loops[deck].out) {
                    if (players[deck].getCurrentTime() >= loops[deck].out) players[deck].seekTo(loops[deck].in, true);
                }
            });
        }

        function tapBpm(deck) {
            const now = Date.now();
            const data = tapData[deck];
            if (now - data.lastTap > 2000) { data.count = 0; data.total = 0; }
            if (data.count > 0) {
                const bpm = Math.round(60000 / ((data.total + (now - data.lastTap)) / data.count));
                document.getElementById(`bpm-${deck.toLowerCase()}`).innerText = `${bpm} BPM`;
            }
            data.lastTap = now; data.count++;
        }

        // --- MIXER ---
        function updateVolume() {
            const master = document.getElementById('master-vol').value / 100;
            const xVal = document.getElementById('crossfader').value;
            const gainA = document.getElementById('gain-a').value / 100;
            const gainB = document.getElementById('gain-b').value / 100;

            let xVolA = 1, xVolB = 1;
            if (xVal < 50) xVolB = (xVal / 50);
            else if (xVal > 50) xVolA = 1 - ((xVal - 50) / 50);

            if (ready.A) players.A.setVolume(gainA * xVolA * master * 100);
            if (ready.B) players.B.setVolume(gainB * xVolB * master * 100);
        }

        function updateVisuals(deck, state) {
            const d = deck.toLowerCase();
            const vinyl = document.getElementById(`vinyl-${d}`);
            const btn = document.getElementById(`play-${d}`);
            if (state === 1) { vinyl.classList.add('spinning'); vinyl.classList.remove('paused'); btn.classList.add('active'); }
            else { vinyl.classList.add('paused'); btn.classList.remove('active'); }
        }

        // --- SYNC ---
        document.getElementById('sync-toggle').addEventListener('change', (e) => {
            const knob = document.getElementById('sync-knob');
            const btns = [document.getElementById('sync-btn-a'), document.getElementById('sync-btn-b')];
            if(e.target.checked) {
                knob.style.transform = 'translateX(20px)'; knob.style.background = 'var(--accent)';
                btns.forEach(b => b.style.display = 'block');
            } else {
                knob.style.transform = 'translateX(0)'; knob.style.background = '#fff';
                btns.forEach(b => b.style.display = 'none');
            }
        });

        function syncDeck(target) {
            if(!ready.A || !ready.B) return;
            const source = (target === 'A') ? players.B : players.A;
            const rate = source.getPlaybackRate();
            document.getElementById(`pitch-${target.toLowerCase()}`).value = rate;
            updatePitch(target);
            log(`Synced Deck ${target} to ${rate}x`);
        }
    </script>
</body>
</html>